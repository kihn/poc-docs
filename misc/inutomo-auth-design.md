# イヌトモNow 認証・位置共有設計まとめ

## 背景と課題
イヌトモNow は  
**「イヌともになった犬が、今どこを散歩しているか分かる」**  
ことをメイン機能とするアプリである。

そのため以下の制約がある。

- リアルタイム位置情報という **高リスク情報** を扱う
- 個人開発のため、  
  - Google / Apple / LINE 認証を全部そろえるのは負担が大きい
- ユーザーに  
  - 「メールアドレスを渡したくない」  
    という心理的不安がある

このため  
**「簡単・セキュア・安心」** を満たす認証方式と  
**安全な位置情報公開設計** を検討した。

---

## 結論サマリ
- メイン機能が「今どこ」なので **ログインは必須**
- ただし **メールアドレス必須にする必要はない**
- 認証の主軸は **パスキー（Passkey / WebAuthn）**
- バックエンドは  
  **Cloudflare Workers（Hono）で自前認証 + Firestore をストレージ**  
  が最も相性が良い

---

## なぜログインが必要か
「今どこを散歩しているか」を他人に見せる場合、以下が不可欠。

1. 悪用対策（ストーカー・待ち伏せ防止）
2. 同意管理（誰に見せるか）
3. 通報・ブロック・BAN などの責任管理

ゲスト利用のままではこれらが成立しないため、  
**リアルタイム位置表示はログイン必須** とする。

---

## メールアドレス不安への対応方針
### 基本思想
> ログイン ＝ 個人情報を預ける  
ではなく  
> ログイン ＝ 端末で本人性を証明する  

に寄せる。

### 採用方針
- **パスキー（Passkey）をメイン認証にする**
  - メール不要
  - パスワード不要
  - Face ID / 指紋などでログイン
- フォールバックとして
  - 電話番号OTP or 任意メール（復旧用）を検討

---

## ゲスト利用の扱い
### ゲストで許可するもの
- 散歩体験（自分の散歩）
- 犬プロフィール作成（端末内保存）
- 「このエリアに犬が多い」などの **ぼかした情報**

### ゲストで禁止するもの
- 個体が特定できるリアルタイム位置
- ピン表示
- 今散歩中の特定犬の表示
- 他ユーザーとの直接的交流

---

## 最終まとめ
- メイン機能的にログインは必須
- メール必須にはしない
- パスキー中心が最も体験と安全のバランスが良い
